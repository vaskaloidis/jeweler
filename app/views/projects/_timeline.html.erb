<% @timeline_modals = true %>
<ul id="timeline_container" class="cbp_tmtimeline">

  <li id="create_note_inline" style="display:none">
  </li>

  <% if notes.empty? %>
    <li>
      <time class="cbp_tmtime" datetime="2014-12-06T18:30">
        <span class="large">Now</span></time>
      <div class="cbp_tmicon timeline-bg-gray">
        <i class="fas fa-sticky-note"></i>
      </div>
      <div class="cbp_tmlabel empty">
        <span>No Activity</span>
      </div>
    </li>
  <% else %>

    <% notes.each do |note| %>

      <li id="timeline_note_<%= note.id.to_s %>">
        <time class="cbp_tmtime" datetime="2014-12-06T03:45">
          <span><%= note.created_at.strftime("%H:%M") %></span>

          <% if note.created_at == Date.today %>
            <span>Today</span>
          <% elsif note.created_at == Date.yesterday %>
            <span>Yesterday</span>
          <% else %>
            <span><%= note.created_at.strftime("%d %b. %Y") %></span>
          <% end %>
        </time>

        <% if note.note_type == 'note' %>
          <div class="cbp_tmicon timeline-bg-success">
            <i class="fas fa-sticky-note"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>
        <% elsif note.note_type == 'demo' %>
          <div class="cbp_tmicon timeline-bg-red">
            <i class="fa-binoculars"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <div class="row">
              <div class="col-xs-5">
                <a href="#">
                  <img src="<%= note.image.url %>" class="img-responsive img-rounded full-width">
                </a><br>
                <%= render 'notes/note_meta', note: note, current_user: current_user %>
              </div>
            </div>
          </div>

        <% elsif note.note_type == 'project_update' %>
          <div class="cbp_tmicon timeline-bg-warning">
            <i class="far fa-clock"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'event' %>
          <div class="cbp_tmicon timeline-bg-info">
            <i class="far fa-clock"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'payment' %>
          <div class="cbp_tmicon timeline-bg-success">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'payment_request' %>
          <div class="cbp_tmicon timeline-bg-success">
            <i style="color:white !important" class="fas fa-hand-holding-usd white-icon"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'project_update' %>
          <div class="cbp_tmicon timeline-bg-warning">
            <i class="far fa-clock"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'event' %>
          <div class="cbp_tmicon timeline-bg-info">
            <i class="far fa-clock"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h3><%= note.content %></h3>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% elsif note.note_type == 'commit' %>
          <div class="cbp_tmicon timeline-bg-danger">
            <i class="fas fa-code-branch"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <% lines = note.content.lines('<br>') %>
            <% if lines.count > 10 %>
              <p>
                <% lines.each_with_index do |line, index| %>
                  <% if index == 10 %>
                    <a href="#" onclick="$('#note_hidden_row_<%= note.id.to_s %>').toggle('slide'); return false;">
                      <small>(More...)</small>
                    </a>
                    <p style="display:none" id="note_hidden_row_<%= note.id.to_s %>">
                      <%= line.html_safe %>
                  <% elsif index == lines.count %>
                    <%= line.html_safe %>
                    </p>
                  <% else %>
                    <%= line.html_safe %>
                  <% end %>
                <% end %>
                </p>
            <% else %>
              <h4><%= note.content.html_safe %></h4>
            <% end %>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>

        <% else %>
          <div class="cbp_tmicon timeline-bg-success">
            <i class="fas fa-sticky-note"></i>
          </div>
          <div class="cbp_tmlabel">
            <%= render 'notes/note_header', note: note %>
            <h4><%= note.content.html_safe %></h4>
            <%= render 'notes/note_meta', note: note, current_user: current_user %>
          </div>
        <% end %>
      </li>
    <% end %>
  <% end %>
</ul>
